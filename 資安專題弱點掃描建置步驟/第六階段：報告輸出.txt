ğŸ“Œ ç¬¬å…­éšæ®µï¼šå ±å‘Šè¼¸å‡ºï¼ˆç¢ç‰‡åŒ–æ­¥é©Ÿï¼‰
6.1 çµ±æ•´æ‰€æœ‰æ¨¡çµ„çµæœ
æ”¶é›†ä»¥ä¸‹æ¨¡çµ„çš„è¼¸å‡ºï¼š

port_scan â†’ é–‹æ”¾çš„ port æ¸…å–®

banner â†’ æ¯å€‹ port çš„ banner

version_compare â†’ åˆ¤æ–·ç‰ˆæœ¬æ˜¯å¦éèˆŠ

http_check â†’ HTTP åŸºæœ¬æª¢æŸ¥çµæœ

web_vuln_test â†’ Webæ¼æ´åŸºç¤æ¸¬è©¦çµæœ


6.2 æ ¼å¼åŒ–è¼¸å‡º
JSON æ ¼å¼ï¼ˆæ–¹ä¾¿ç¨‹å¼è™•ç†ï¼‰ï¼š

{
  "open_ports": [
    {"port": 22, "service": "OpenSSH", "version": "7.2p1", "status": "Outdated"},
    {"port": 80, "service": "Apache", "version": "2.4.41", "status": "OK"}
  ],
  "http_checks": {
    "directory_listing": "YES",
    "https_usage": "NO",
    "tls_version": "TLS 1.0 (Weak)",
    "sensitive_headers": ["Server", "X-Powered-By"]
  },
  "web_vuln_tests": {
    "sensitive_files": ["robots.txt: Not Found", "admin/: Not Found"],
    "error_leak": "Not Found",
    "sql_injection": "Not Found",
    "xss": "Not Found",
    "cookie_security": ["Cookie Security OK"]
  }
}


è¡¨æ ¼/æ–‡å­—è¼¸å‡ºï¼ˆæ–¹ä¾¿äººé¡é–±è®€ï¼‰ï¼š

[+] Open Ports:
    22/tcp (OpenSSH 7.2p1) - Version outdated
    80/tcp (Apache 2.4.41)

[+] HTTP Checks:
    Directory Listing: NO
    HTTPS: NO
    TLS Version: TLS 1.0 (Weak)
    Sensitive Headers: Server, X-Powered-By

[+] Web Vulnerability Tests:
    Sensitive Files: robots.txt (Not Found), admin/ (Not Found)
    Error Leak: Not Found
    SQL Injection: Not Found
    XSS: Not Found
    Cookie Security: Cookie Security OK

6.3 æ”¯æ´è¼¸å‡ºåˆ°æª”æ¡ˆï¼ˆå¯é¸ï¼‰
å¯ä»¥é¸æ“‡æŠŠçµæœå¯«åˆ°ï¼š

report.json â†’ æ©Ÿå™¨å¯è®€

report.txt â†’ äººé¡å¯è®€

ç¯„ä¾‹ç¨‹å¼ç‰‡æ®µï¼š

reports.py

import json

def generate_report(verdicts, result, vuln_results, json_path="data/report.json", txt_path="data/report.txt"):
    """
    çµ±æ•´æ‰€æœ‰æ¨¡çµ„çµæœä¸¦è¼¸å‡ºæˆ JSON èˆ‡ TXT å ±å‘Š
    :param verdicts: version_compare çš„çµæœ (list of dict)
    :param result: http_check çš„çµæœ (dict)
    :param vuln_results: web_vuln_test çš„çµæœ (dict)
    :param json_path: JSON å ±å‘Šè¼¸å‡ºè·¯å¾‘
    :param txt_path: TXT å ±å‘Šè¼¸å‡ºè·¯å¾‘
    """

    # çµ±æ•´æˆä¸€ä»½å­—å…¸
    report = {
        "open_ports": verdicts,
        "http_checks": result,
        "web_vuln_tests": vuln_results
    }

    # è¼¸å‡º JSON
    with open(json_path, "w", encoding="utf-8") as f:
        json.dump(report, f, indent=4, ensure_ascii=False)

    # è¼¸å‡ºæ–‡å­—
    with open(txt_path, "w", encoding="utf-8") as f:
        f.write("[+] Open Ports:\n")
        for v in verdicts:
            f.write(f"    {v['port']}/tcp ({v['service']} {v['version']}) - {v['status']}\n")

        f.write("\n[+] HTTP Checks:\n")
        f.write(f"    Directory Listing: {result['directory_listing']}\n")
        f.write(f"    HTTPS: {result['https_usage']}\n")
        f.write(f"    TLS Version: {result['tls_check']}\n")
        f.write(f"    Sensitive Headers: {', '.join([k for k,v in result['sensitive_headers'].items() if v != 'ç¼ºå¤±'])}\n")

        f.write("\n[+] Web Vulnerability Tests:\n")
        f.write(f"    Sensitive Files: {', '.join(vuln_results['sensitive_files'])}\n")
        f.write(f"    Error Leak: {vuln_results['error_leak']}\n")
        f.write(f"    SQL Injection: {vuln_results['sql_injection']}\n")
        f.write(f"    XSS: {vuln_results['xss']}\n")
        f.write(f"    Cookie Security: {', '.join(vuln_results['cookie_security'])}\n")

    return report



scanner.pyç¯„ä¾‹
import requests
import json

from modules import port_scan, banner, version_compare, http_check, web_vuln_test, report

# -------------------------
# ä¸»ç¨‹å¼å…¥å£
# -------------------------
if __name__ == "__main__":
    target_ip = "127.0.0.1"
    ports = [22, 80, 443, 3306, 6379]
    #ssh, http, https, mysql, Redis

    open_ports = port_scan.port_scan(target_ip, ports)
    print("[+] Open Ports:", open_ports)

    banners = banner.grab_banners(target_ip, open_ports)
    print("[+] Banners:", banners)

    baseline = version_compare.load_baseline("data/known_versions.json")
    verdicts = version_compare.evaluate_banners(banners, baseline)
    for v in verdicts:
        print(f"- {v.get('port')}/tcp {v.get('service')} {v.get('version')} â†’ {v.get('status')}")

    # ç¬¬å››éšæ®µï¼šHTTP åŸºæœ¬æª¢æŸ¥ 
    if 80 in open_ports: 
        print("[+] HTTP Basic Check:") 
        result = http_check.http_basic_check(target_ip, 80, use_https=False) 
        print(result) 
        # ç¬¬äº”éšæ®µï¼šWebæ¼æ´åŸºç¤æ¸¬è©¦ 
        print("[+] Web Vulnerability Tests:") 
        vuln_results = web_vuln_test.run_tests(target_ip, 80) 
        print(vuln_results)

        # è¼¸å‡ºåˆ° JSON æª”æ¡ˆ 
        with open("data/web_vuln_results.json", "w", encoding="utf-8") as f: 
            json.dump(vuln_results, f, indent=4, ensure_ascii=False)
    if 443 in open_ports: 
        print("[+] HTTPS Basic Check:") 
        result = http_check.http_basic_check(target_ip, 443, use_https=True) 
        print(result)

        print("[+] Web Vulnerability Tests (HTTPS):") 
        vuln_results = web_vuln_test.run_tests(target_ip, 443, use_https=True) 
        print(vuln_results)
        with open("data/web_vuln_results.json", "w", encoding="utf-8") as f: 
            json.dump(vuln_results, f, indent=4, ensure_ascii=False)


# ...
if 80 in open_ports:
    print("[+] HTTP Basic Check:")
    result = http_check.http_basic_check(target_ip, 80, use_https=False)
    print(result)

    print("[+] Web Vulnerability Tests:")
    vuln_results = web_vuln_test.run_tests(target_ip, 80)
    print(vuln_results)

    # ç¬¬å…­éšæ®µï¼šå ±å‘Šè¼¸å‡º
    print("[+] Generating Report...")
    report.generate_report(verdicts, result, vuln_results)

#å¯ä»¥ä½¿ç”¨python -m http.server 80
#æ¸¬è©¦æœ‰æ²’æœ‰è¾¦æ³•æˆåŠŸæƒææ­£åœ¨ç›£è½(å°å¤–é–‹æ”¾)çš„port



æ¸¬è©¦
python scanner.py
